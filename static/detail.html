<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/main.css" />
        <script src="/jquery.js"></script>
        <script>
         $(function(){
             let tpl = {}
             tpl.origin_block = function(){
                 let t = $('<div class="block_origin"> \
                                <div class="block_origin_content"></div> \
                            </div>')
                 return function(block_id, block_type, content){
                     let r = t.clone()
                     r.find('.block_origin_content').text(content)
                     return r
                 }
             }()
             tpl.zhcn_block = function(){
                 let t = $('<div class="block_zhcn"> \
                                <div class="block_zhcn_edit_button">edit</div> \
                                <div class="block_zhcn_content_list"></div> \
                            </div>')
                 let content_box = $('<div class="block_zhcn_content"></div>')
                 return function(content_list){
                     let r = t.clone()
                     let box_list = r.find('.block_zhcn_content_list')
                     content_list.forEach(function(v){
                         let box = content_box.clone()
                         box.text(v)
                         box_list.append(box)
                     })
                     return r
                 }
             }()
             tpl.make_block = function(){
                 let t = $('<div class="block"></div>')
                 return function(block){
                     let r = t.clone()
                     let {extra, origin, type, i18n} = block
                     r.append(tpl.origin_block(extra.block_id, type, origin))
                     if(type == 'text'){
                         r.append(tpl.zhcn_block(i18n))
                     }
                     return r
                 }
             }()
             window.tpl = tpl
         })

        </script>
    </head>
    <body>
        <div class="header"><div><a href="/index.html">Home</a></div></div>
        <div class="main"><div id="block_list">
            loading detail
        </div></div>
        <div class="footer">footer</div>

        <script>
         //function pre_render(state){
         //    document.body.innerHTML = "hello world!";
         //}

         window.chapter = window.location.pathname
                                .match('/detail/([0-9]+)')[1]|0

         $(function(){
             $.ajax({
                 url: '/api/chapter/'+chapter,
                 type: 'get',
                 dataType: 'json',
                 cache: false,
                 success: load_chapter_content_success,
                 async:true,
             });
         })
         function load_chapter_content_success(data){
             let block_list = $('#block_list')
             block_list.empty()
             data.forEach(function(v){
                 block_list.append(window.tpl.make_block(v))
             })
         }
        </script>
    </body>
</html>

